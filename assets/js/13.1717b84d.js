(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{174:function(t,s,a){"use strict";a.r(s);var n=a(0),o=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"saving-customer-orders"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#saving-customer-orders","aria-hidden":"true"}},[t._v("#")]),t._v(" Saving Customer Orders")]),t._v(" "),a("p",[t._v("Saving a customer order is done to preserve changes to an order while keeping it open (i.e., not setting the "),a("code",[t._v("OrderDate")]),t._v("). The customer order to be saved may be a new order or an existing open order. Both of these are handled by a single public BLL method, which internally shunts the main work of saving to two alternate private methods.")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("Save")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token class-name"}},[t._v("EditCustomerOrder")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// Always ensure you have been given data to work with")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("null")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ArgumentNullException")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"order"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Cannot save order; order information was not supplied."')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// Business validation rules")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderDate"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HasValue"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Exception")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$"),a("span",{attrs:{class:"token string"}},[t._v('"An order date of {order.OrderDate.Value.ToLongDateString()} has been supplied. The order date should only be supplied when placing orders, not saving them."')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// Decide whether to add new or update")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("//  NOTE: Notice that no db activity is occuring yet.")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderId "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("AddPendingOrder")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("UpdatePendingOrder")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("The "),a("code",[t._v("Save()")]),t._v(' method performs initial validation, ensuring that the order exists and that the order date is not set. In either case, the order is open (or "pending"), and the work of saving changes ir routed to two separate methods, each of which ensure that the order is '),a("strong",[t._v("processed as a "),a("em",[t._v("single")]),t._v(" transaction")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("AddPendingOrder")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token class-name"}},[t._v("EditCustomerOrder")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" context "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("NorthwindContext")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" orderInProcess "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Orders"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("Add")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Order")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// Make the orderInProcess match the customer order as given...")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// A) The general order information")]),t._v("\n        orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CustomerID "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CustomerId"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EmployeeID "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EmployeeId"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderDate "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderDate"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShipVia "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShipperId"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Freight "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FreightCharge"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// B) Add order details")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" item "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderItems"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token comment"}},[t._v("// Add as a new item")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" newItem "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("OrderDetail")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                ProductID "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" item"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ProductId"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                Quantity "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" item"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderQuantity"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                UnitPrice "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" item"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UnitPrice"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                Discount "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" item"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DiscountPercent\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderDetails"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("Add")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newItem"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// C) Save the changes (one save, one transaction)")]),t._v("\n        context"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("SaveChanges")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("UpdatePendingOrder")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token class-name"}},[t._v("EditCustomerOrder")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" context "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("NorthwindContext")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" orderInProcess "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Orders"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("Find")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderId"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// Make the orderInProcess match the customer order as given...")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// A) The general order information")]),t._v("\n        orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CustomerID "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CustomerId"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EmployeeID "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EmployeeId"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderDate "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderDate"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShipVia "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShipperId"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Freight "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FreightCharge"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// B) Add/Update/Delete order details")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("//    Loop through the items as known in the database (to update/remove)")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" detail "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderDetails"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" changes "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderItems"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("SingleOrDefault")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" x"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ProductId "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" detail"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ProductID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("changes "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("null")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{attrs:{class:"token comment"}},[t._v("//toRemove.Add(detail);")]),t._v("\n                context"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("Entry")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("detail"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("State "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" EntityState"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Deleted"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// flag for deletion")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                detail"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Discount "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" changes"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DiscountPercent"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                detail"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Quantity "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" changes"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderQuantity"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                detail"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UnitPrice "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" changes"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UnitPrice"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                context"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("Entry")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("detail"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("State "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" EntityState"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Modified"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("//    Loop through the new items to add to the database")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" item "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderItems"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token comment"}},[t._v("// Add as a new item")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" newItem "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("OrderDetail")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                ProductID "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" item"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ProductId"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                Quantity "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" item"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderQuantity"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                UnitPrice "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" item"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UnitPrice"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                Discount "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" item"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DiscountPercent\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderDetails"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("Add")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newItem"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// C) Save the changes (one save, one transaction)")]),t._v("\n        context"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("Entry")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderInProcess"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("State "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" EntityState"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Modified"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        context"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("SaveChanges")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}],!1,null,null,null);o.options.__file="customerOrders-Save.md";s.default=o.exports}}]);